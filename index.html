<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>제품 목록</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4 text-center">📦 Allstar / Uhlmann 제품 재고 리스트</h2>
    <div id="productList" class="row gy-4"></div>
  </div>

 <script>
  fetch('https://fencingstocks.netlify.app/.netlify/functions/sheet')
    .then(res => res.json())
    .then(data => {
      const rows = data.values;
      showData(rows);
    });

  function getDeliveryClass(delivery) {
  if (delivery.includes("3주 내 수령") return "bg-success text-white";
  if (delivery.includes("재고 없음 - 5주 이상") return "bg-danger text-white";
  return "bg-light"; // 기본
}
   
  
  function showData(rows) {
  const list = document.getElementById("productList");
  const grouped = {};

  // Grouped by brand-product, gender, others
  rows.forEach(row => {
    const brand = row[0] || "";
    const product_name = row[1] || "";
    const gender = row[3] || "";
    const hand = row[5] || "";
    const size = row[4] || "";
    const delivery = row[7] || "";

    const key = `${brand}||${product_name}`;
    if (!grouped[key]) grouped[key] = {};
    if (!grouped[key][gender]) grouped[key][gender] = [];

    grouped[key][gender].push({ hand, size, delivery });
  });

  // Making top group cards
  Object.entries(grouped).forEach(([key, genderMap]) => {
    const [brand, product_name] = key.split("||");
    const col = document.createElement("div");
    col.className = "col-md-6";

    // Showing bottom level cards
    let genderHtml = Object.entries(genderMap).map(([gender, items]) => {
      const itemListHtml = items.map(item => {
      const deliveryClass = getDeliveryClass(item.delivery);  // Checking delivery status
      return `
        <div class="border rounded p-2 mb-2 ${deliveryClass}">
          <strong>손:</strong> ${item.hand} /
          <strong>사이즈:</strong> ${item.size} /
          <strong>배송:</strong> ${item.delivery}
        </div>
      `;
    }).join("");

      return `
        <div class="mb-3">
          <h6 class="text-primary">👤 성별: ${gender}</h6>
          ${itemListHtml}
        </div>
      `;
    }).join("");

    col.innerHTML = `
      <div class="card shadow">
        <div class="card-body">
          <h4 class="card-title">${brand}</h4>
          <h5 class="card-subtitle mb-3 text-muted">${product_name}</h5>
          ${genderHtml}
        </div>
      </div>
    `;
    list.appendChild(col);
  });
}

 </script>


</body>
</html>
